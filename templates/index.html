<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Management UI</title>
    <link rel="stylesheet" href="/static/style.css">
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
</head>
<body>
    <div class="container">
        <!-- Single screen for routes and inputs -->
        <div class="routes-container">
            <!-- Route 1 - Cloned Project -->
            <div class="route-panel">
                <h3>Cloned Project</h3>
                <label for="file-type">Enter file extension (e.g., .py, .ts):</label>
                <input type="text" id="file-type" placeholder=".py, .ts" />
                <button onclick="loadFiles('cloned_project')">Load Files</button>
            </div>

            <!-- Route 2 - Routers -->
            <div class="route-panel">
                <h3>Routers</h3>
                <label for="file-names-schemas">Load button to view files in Routers</label> 
                <button onclick="loadFiles('routers')">Load Files</button>
                <label for="file-names-routers">Enter file names Below:</label>
                <input type="text" id="file-names-routers" placeholder="Provide the file path file1.ts, file2.py" />
                <button onclick="postFiles('routers')">Post Files to Routers</button> <!-- New button -->
            </div>

            <!-- Route 3 - Schemas -->
            <div class="route-panel">
                <h3>Schemas</h3>
                <label for="file-names-schemas">Load button to view files in Schemas</label>                
                <button onclick="loadFiles('schemas')">Load Files</button>
                <label for="file-names-schemas">Enter file names Below:</label> 
                <input type="text" id="file-names-schemas" placeholder="Provide the file path file1.ts, file2.py"" />
                <button onclick="postFiles('schemas')">Post Files to Schemas</button> <!-- New button -->
            </div>
        </div>

        <!-- File List Panel -->
        <div class="panel">
            <h2>Files</h2>
            <ul id="file-list"></ul>
        </div>

        <!-- File Content Panel -->
        <div class="panel">
            <h2>File Content</h2>
            <pre id="file-content">Select a file to view its content.</pre>
        </div>
    </div>

    <script>
        let selectedFile = ""; // Stores the currently selected file path

        // Load files for a specific route and extension
        async function loadFiles(routeName) {
            let fileExtension = document.getElementById("file-type").value.trim();
            let fileNames = [];

            if (routeName === 'cloned_project') {
                fileNames = []; // No file names needed for cloned project
            } else if (routeName === 'routers') {
                fileNames = document.getElementById("file-names-routers").value.trim().split(',');
            } else if (routeName === 'schemas') {
                fileNames = document.getElementById("file-names-schemas").value.trim().split(',');
            }

            if (routeName === "cloned_project" && fileExtension) {
                fetchFiles(routeName, fileExtension); // Fetch files based on file extension for cloned_project
            } else if ((routeName === "routers" || routeName === "schemas") && fileNames.length > 0) {
                fetchFilesByNames(routeName, fileNames); // Fetch files based on names for routers or schemas
            } else {
                alert("Please enter valid input.");
            }
        }

        // Fetch and display files based on file extension for the "Cloned Project"
        async function fetchFiles(routeName, fileExtension) {
            try {
                const response = await axios.get(`/api/list-files/${routeName}`, {
                    params: { file_extension: fileExtension }
                });
                const fileList = document.getElementById("file-list");
                fileList.innerHTML = ""; // Clear previous file list
                document.getElementById("file-content").innerText = "Select a file to view its content.";

                response.data.files.forEach((file) => {
                    let relativePath = file.split("Cloned_Project\\")[1];  // Extract content after 'Cloned_Project'
                    const listItem = document.createElement("button");
                    listItem.innerText = relativePath;
                    listItem.onclick = () => {
                        selectedFile = file; 
                        loadFileContent(file);
                    };
                    fileList.appendChild(listItem);
                });
            } catch (error) {
                console.error("Error loading files:", error);
            }
        }

        // Fetch and display files based on file names for "Routers" and "Schemas"
        async function fetchFilesByNames(routeName, fileNames) {
            try {
                const response = await axios.get(`/api/list-files/${routeName}`, {
                    params: { file_names: fileNames.join(",") }
                });
                const fileList = document.getElementById("file-list");
                fileList.innerHTML = ""; // Clear previous file list
                document.getElementById("file-content").innerText = "Select a file to view its content.";

                response.data.files.forEach((file) => {
                    let relativePath = file.split("src\\")[1];  // Extract content after 'Cloned_Project'
                    const listItem = document.createElement("button");
                    listItem.innerText = relativePath;
                    listItem.onclick = () => {
                        selectedFile = file;
                        loadFileContent(file);
                    };
                    fileList.appendChild(listItem);
                });
            } catch (error) {
                console.error("Error loading files:", error);
            }
        }

        // Load and display the content of a selected file
        async function loadFileContent(filePath) {
            try {
                const response = await axios.get(`/api/get-file-content`, { params: { file_path: filePath } });
                document.getElementById("file-content").innerText = response.data.content;
            } catch (error) {
                console.error("Error loading file content:", error);
            }
        }

        // Post the selected file names to the appropriate route (Routers/Schemas)
        async function postFiles(routeName) {
            let fileNames = [];

            if (routeName === 'routers') {
                fileNames = document.getElementById("file-names-routers").value.trim().split(',');
            } else if (routeName === 'schemas') {
                fileNames = document.getElementById("file-names-schemas").value.trim().split(',');
            }

            try {
                if (fileNames.length > 0) {
                    const response = await axios.post(`/copy-files-to-${routeName}`, { files: fileNames });
                    alert(response.data.message); // Show success message
                } else {
                    alert("Please enter valid file names.");
                }
            } catch (error) {
                console.error("Error posting files:", error);
                alert("Error processing files.");
            }
        }
    </script>
</body>
</html>
